# Claude 情緒分析與 Meme 推薦系統流程圖

## 整體執行流程

```
開始
  ↓
載入 Excel 檔案 (Comments_Meme_Similarity.xlsx)
  ↓
初始化 Claude API 和 Meme 資料庫
  ↓
逐行處理留言
  ↓
┌─────────────────┐
│ 1. 人身攻擊檢測  │
└─────────────────┘
  ↓
判斷是否為人身攻擊？
  ↓                    ↓
 是                   否
  ↓                    ↓
┌─────────────────┐   跳過推薦
│ 2. 情緒分析      │   標記為"非人身攻擊"
│ (contempt,      │
│  anger, disgust)│
└─────────────────┘
  ↓
┌─────────────────┐
│ 3. 計算相似度    │
│ (Cosine         │
│  Similarity)    │
└─────────────────┘
  ↓
┌─────────────────┐
│ 4. 排序與分組    │
│ 選擇推薦        │
└─────────────────┘
  ↓
寫入結果到 G, H, I 欄位
  ↓
處理下一行留言
  ↓
全部完成，保存檔案
  ↓
結束
```

## Meme 選擇過程詳細圖解

### 步驟 1: 計算所有 Meme 的相似度

```
用戶留言情緒: [contempt: 0.7, anger: 0.2, disgust: 0.1]
                    ↓
            計算與所有 Meme 的 Cosine Similarity
                    ↓
        Meme_A: 0.95    Meme_B: 0.88    Meme_C: 0.82    ...    Meme_Z: 0.05
```

### 步驟 2: 排序 (高到低)

```
排名:  1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16
     ┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┐
相似度│0.95│0.92│0.89│0.88│0.85│0.82│0.80│0.78│0.76│0.74│0.72│0.70│0.68│0.66│0.64│0.62│
     └────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┘
      ↑←──────────── 高分組選擇範圍 (1-8) ──────────→↑

排名: 17   18   19   20   21   22   23   24   25   26   27   28   29   30   31   32
     ┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┐
相似度│0.60│0.58│0.56│0.54│0.52│0.50│0.48│0.46│0.44│0.42│0.40│0.38│0.36│0.34│0.32│0.30│
     └────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┘
      ↑←──────────── 中分組選擇範圍 (17-24) ──────────→↑

排名: 33   34   35   36   37   38   39   40   41   42   43   44   45   46   47   48
     ┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┐
相似度│0.28│0.26│0.24│0.22│0.20│0.18│0.16│0.14│0.12│0.10│0.08│0.06│0.04│0.03│0.02│0.01│
     └────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┘
                                          ↑←──── 低分組選擇範圍 (41-48) ────→↑
```

### 步驟 3: 隨機選擇邏輯

```
🎯 高分組 (High Similarity)
┌─────────────────────────────────────┐
│ 排名 1-16 中的前 8 個               │
│ ┌─┬─┬─┬─┬─┬─┬─┬─┐               │
│ │1│2│3│4│5│6│7│8│                 │
│ └─┴─┴─┴─┴─┴─┴─┴─┘                 │
│      ↓ random.sample(2)            │
│   選中: 排名 3, 7                   │
└─────────────────────────────────────┘

🎯 中分組 (Medium Similarity)
┌─────────────────────────────────────┐
│ 排名 17-32 中的 17-24               │
│ ┌──┬──┬──┬──┬──┬──┬──┬──┐          │
│ │17│18│19│20│21│22│23│24│          │
│ └──┴──┴──┴──┴──┴──┴──┴──┘          │
│      ↓ random.sample(2)            │
│   選中: 排名 19, 22                 │
└─────────────────────────────────────┘

🎯 低分組 (Low Similarity)
┌─────────────────────────────────────┐
│ 排名 33-48 中的 41-48               │
│ ┌──┬──┬──┬──┬──┬──┬──┬──┐          │
│ │41│42│43│44│45│46│47│48│          │
│ └──┴──┴──┴──┴──┴──┴──┴──┘          │
│      ↓ random.sample(2)            │
│   選中: 排名 43, 46                 │
└─────────────────────────────────────┘
```

## 最終輸出示例

```
=== 推薦結果 ===
總共 50 個 memes

高相似度組（排名1-16中隨機選擇1-8的2個）：
1. Drake-NoYes (排名: 3, 相似度: 0.892)
2. Angry-Baby (排名: 7, 相似度: 0.785)

中相似度組（排名17-32中隨機選擇17-24的2個）：
1. Confused-Gandalf (排名: 19, 相似度: 0.564)
2. Hide-the-Pain-Harold (排名: 22, 相似度: 0.498)

低相似度組（排名33-48中隨機選擇41-48的2個）：
1. Happy--Shock (排名: 43, 相似度: 0.089)
2. You-The-Real-MVP (排名: 46, 相似度: 0.032)
```

## Excel 輸出格式

```
| Comments      | ... | G (高分組)                 | H (中分組)                    | I (低分組)                  |
|---------------|-----|---------------------------|-------------------------------|----------------------------|
| 你真的很蠢    | ... | Drake-NoYes; Angry-Baby   | Confused-Gandalf; Hide-Pain   | Happy-Shock; You-Real-MVP  |
| 非攻擊性留言  | ... | 非人身攻擊                | 非人身攻擊                    | 非人身攻擊                 |
```

## 隨機性保證

每次執行相同留言時，選擇的 Meme 可能不同：

```
第一次執行:
高分組: [排名2, 排名5] → [Meme_B, Meme_E]

第二次執行:
高分組: [排名1, 排名8] → [Meme_A, Meme_H]

第三次執行:
高分組: [排名4, 排名6] → [Meme_D, Meme_F]
```

這樣確保了實驗的多樣性和隨機性！
